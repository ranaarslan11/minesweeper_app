<h1 class="text-center my-4">Board: <%= @board.name %></h1>
<p class="text-center mb-3">Generated by: <%= @board.email %></p>

<!-- Display the Minesweeper board -->
<div class="container">
  <table class="table table-bordered" id="minesweeper-board" style="width: auto; margin: 0 auto;">
    <tbody>
      <% @board.height.times do |row| %>
        <tr>
          <% @board.width.times do |col| %>
            <td 
              data-row="<%= row %>" 
              data-col="<%= col %>" 
              class="cell text-center align-middle p-2 <%= @board.revealed_data[row][col] ? 'revealed' : 'unrevealed' %> <%= @board.flagged_data[row][col] ? 'flagged' : '' %>" 
              oncontextmenu="flagCell(event)" 
              onclick="revealCell(event)"
              style="width: 40px; height: 40px; background-color: #bfc3bf; font-size: 1.2rem;">
              <% if @board.revealed_data[row][col] %>
                <% if @board.board_data[row][col] == 'M' %>
                  ðŸ’£
                <% else %>
                  <%= @board.board_data[row][col] %>
                <% end %>
              <% elsif @board.flagged_data[row][col] %>
                ðŸš©
              <% end %>
            </td>
          <% end %>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>

<div class="text-center mt-4">
  <%= link_to 'Back to Home', root_path, class: 'btn btn-primary' %>
</div>

<!-- JavaScript for interactivity -->
<script>
  // Flag cell on right-click
  function flagCell(event) {
    event.preventDefault();
    const cell = event.target;
    if (cell.classList.contains('flagged')) {
      cell.classList.remove('flagged');
      cell.innerHTML = '';  // Clear the flag
    } else {
      cell.classList.add('flagged');
      cell.innerHTML = 'ðŸš©';  // Add the flag
    }
  }

  // Reveal cell on left-click
  function revealCell(event) {
    const cell = event.target;
    const row = cell.dataset.row;
    const col = cell.dataset.col;

    // Make an AJAX call to reveal the cell on the server side
    fetch(`/boards/<%= @board.id %>/reveal_cell?row=${row}&col=${col}`, {
      method: 'POST',
      headers: {
        'X-CSRF-Token': document.querySelector('[name="csrf-token"]').content
      }
    }).then(response => response.json()).then(data => {
      if (data.game_over) {
        alert('Game over! You clicked on a mine.');
        location.reload(); // Reload the board if game over
      } else {
        cell.innerHTML = data.cell_value;
        cell.classList.remove('unrevealed');
      }
    });
  }
</script>
